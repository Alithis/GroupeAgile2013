@model IEnumerable<NoteTaLoc.Models.AdresseTable>

@*
@{
    Layout = null;
 }
*@
<style>.map_canvas
{
    width: 60%; 
    height: 450px;
    float: left;
    margin-right: 5px;
}
.search_result
{
    width: auto; 
    height: 450px;
    float: right;
}
.note
{
 border: 1px solid gray;
}
</style>
<script type="text/javascript" src="../../Scripts/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">

    var carte;
    var arrlong  = [];
    var arrlatt  = [];
    var bounds;

    $(document).ready(function () {
        initialiser();

        $(".note").click(function () {
            var point = fctPoint($(this).find("#item_Lattitude").val(), $(this).find("#item_Longitude").val());
            carte.panTo(point); //'=== deplacement smooth
        });

//Pour la gestion d'interface du tableau et du comportement du cursor
             $('.note')
            .click(function () {
                //$(this).parent().find('note_selected').each(function (index, element) {
                //    $(element).removeClass('note_selected'); //Retire la selection précédente
                $(".note_selected").removeClass('note_selected');
                //});
                $(this).addClass('note_selected'); //Ajoute la nouvel sélection
            })
            .hover(
            //=== Lors du passage de la souris sur la ligne on applique la classe RowSelection
            //=== Lorsque la souris est a l'exterieur de la ligne la classe RowSelection est retiré
                function () { $(this).addClass("note_hover").css('cursor', 'pointer'); },
                function () { $(this).removeClass("note_hover"); }
            );

    });

    var initialiser = function () {
        var options = {
            //center:  new google.maps.LatLng(45.30, -73.35),
            //zoom: 2,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        bounds = new google.maps.LatLngBounds(null);
        carte = new google.maps.Map(document.getElementById("map_canvas"), options);

        //Positionne montreal par defaut
        //var point = fctPoint('45.30', '-73.35');
        //carte.panTo(point); //'=== deplacement smooth
        //bounds.extend(point);


        for (i = 0; i < arrlong.length; i++) {
            fctSetMarqueur(arrlatt[i], arrlong[i]);
        }
       carte.fitBounds(bounds);
       carte.panToBounds(bounds);
    }

    var fctSetMarqueur = function (plngLat, plngLgt) {
        var point = fctPoint(plngLat, plngLgt)
        bounds.extend(point);
        var marqueur = new google.maps.Marker({
            position: point,
            map: carte });

        var infowindow = new google.maps.InfoWindow();

        google.maps.event.addListener(marqueur, 'click', function() {
            window.open('', '_blank');
        });
    }

    var fctPoint = function (plngLat, plngLgt) {
        var lngLgt = parseFloat(plngLgt.replace(',', '.').replace(' ', ''));
        var lngLat = parseFloat(plngLat.replace(',', '.').replace(' ', ''));
        var point = new google.maps.LatLng(lngLat, lngLgt);

        return point;
    }


</script>

<style>

.map_canvas
{
    width: 60%;
    height: 400px;
    float: left;
    margin-right: 10px;
}

.search_result
{
    width: 20%;
    height: 400px;
    float: right;
    margin-left: 2px;
}
.note, .note_hover, .note_seleted
{
 border: 1px solid gray;
}

.note_hover
{
    background-color: #00ace8;
}

.note_selected
{
    background-color: #9ecf35;
}


</style>

@using (Html.BeginForm("SearchNoted", "AdresseTable"))
{    
    <div class="row-fluid">
        <div class="span12 centered_div">
            <div class="span3 offset4">
                @Html.TextBox("searchString")
            </div>
            <div class="span1">
                <input type="submit" id="btnSearch" class="btn btn-medium  btn-primary"/>            
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span10 offset1 background_div">
            <div id="map_canvas" class="map_canvas span7"></div>
            <div id="seach_result"  class="seach_result span5 pre-scrollable" style="margin-left: 0%;">
                <fieldset class="seach_result">
                <legend>&nbsp;&nbsp;Résultats&nbsp;&nbsp;</legend>    
                @{
                    int counter = 0;
                }
                @foreach (var item in Model)
                {        
                    <div class="note" id="note_@counter">
                        Adresse : @Html.DisplayFor(model => item.AdresseLine)<br />
                        Note : @Html.DisplayFor(model => item.AvgNote)&nbsp;             
                        @Html.HiddenFor(model => item.Longitude)<br />
                        @Html.HiddenFor(model => item.Lattitude)<br />
                        <script>
                            arrlong[@(counter)] = '@item.Longitude';
                            arrlatt[@(counter)] = '@item.Lattitude';                 
                        </script>       
                    </div>        
                    counter++;
                }
                </fieldset>
            </div>   
        </div>
    </div>
}

