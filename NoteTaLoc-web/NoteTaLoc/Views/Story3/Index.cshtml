@{
    ViewBag.Title = "Story3";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Story3 : détails d'une adresse</h2>

<!-- Button to trigger modal -->
<a href="#myModal" role="button" class="btn" data-toggle="modal">Launch demo modal</a>
 
<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-body">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><img src="/Images/Story3/button_close.png" /> </button>
            <h3>&nbsp;</h3>
        </div>
        <div class="row-fluid offset1 background_div">
            <div class="span6">
                <div class="span8" id="adresse">
                    <h1>1155 Rue Metcalfe, Montréal, QC H3B 4J5, Canada</h1>
                </div>
                <div class="span4" id="noteTotale">
                    <h2>5 / 5</h2>
                </div>
            </div>
            <div class="span6">
                <div id="myCarousel" class="carousel slide">
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                        <li data-target="#myCarousel" data-slide-to="1"></li>
                        <li data-target="#myCarousel" data-slide-to="2"></li>
                    </ol>
                    <!-- Carousel items -->
                    <div class="carousel-inner">
                        <div class="active item">
                            <img src="/Images/Story3/sunlife_building_01.jpg"/>
                        </div>
                        <div class="item">
                            <img src="/Images/Story3/sunlife_building_02.jpg" />
                        </div>
                        <div class="item">
                            <img src="/Images/Story3/sunlife_building_03.jpg" />
                        </div>
                    </div>
                    <!-- Carousel nav -->
                    <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
                    <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <table id="utilisateurs">
                    <caption>Détails des notes par utilisateur</caption>
                    <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>Utilisateur</th>
                            <th>Date</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="hidden" value="11" /><img src="/Images/Story3/button_plus.gif"/></td>
                            <td><input type="text" readonly="readonly" value="arnaud" /></td>
                            <td><input type="date" readonly="readonly" value="11 juin 2012" /></td>
                            <td><input type="number" readonly="readonly" value="11" /></td>
                        </tr>
                        <tr>
                            <td><input type="hidden" value="7"/></td>
                            <td><input type="text" readonly="readonly" value="solenne" /></td>
                            <td><input type="date" readonly="readonly" value="10 février 2011" /></td>
                            <td><input type="number" readonly="readonly" value="11" /></td>
                        </tr>
                        <tr>
                            <td><input type="hidden" value="6"/></td>
                            <td><input type="text" readonly="readonly" value="laurence" /></td>
                            <td><input type="date" readonly="readonly" value="9 mars 2010" /></td>
                            <td><input type="number" readonly="readonly" value="11" /></td>
                        </tr>
                        <tr>
                            <td><input type="hidden" value="8"/></td>
                            <td><input type="text" readonly="readonly" value="christophe" /></td>
                            <td><input type="date" readonly="readonly" value="14 juillet 2009" /></td>
                            <td><input type="number" readonly="readonly" value="11" /></td>
                        </tr>
                        <tr>
                            <td><input type="hidden" value="9"/></td>
                            <td><input type="text" readonly="readonly" value="sunny" /></td>
                            <td><input type="date" readonly="readonly" value="25 janvier 2008" /></td>
                            <td><input type="number" readonly="readonly" value="11" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        var data = {
            "adresseId": "20135411",
            "adresse": "1155 Rue Metcalfe, Montréal, QC H3B 4J5, Canada",
            "moyenneAdresse": 5,
            "users": [
                {
                    "userId": 11,
                    "pseudo": "arnaud",
                    "noteDate": "11 juin 2012",
                    "moyenneUtilisateur": 5,
                    "notes": [
                        {
                            "categorie": "Isolation",
                            "criteria": "Phonique",
                            "note": 5
                        },
                        {
                            "categorie": "Isolation",
                            "criteria": "Thermique",
                            "note": 5
                        },
                        {
                            "categorie": "Environnement",
                            "criteria": "Voisinage",
                            "note": 5
                        },
                        {
                            "categorie": "Environnement",
                            "criteria": "Commodités",
                            "note": 5
                        }
                    ]
                },
                {
                    "userId": 7,
                    "pseudo": "solenne",
                    "noteDate": "10 février 2011",
                    "moyenneUtilisateur": 5
                },
                {
                    "userId": 6,
                    "pseudo": "laurence",
                    "noteDate": "9 mars 2010",
                    "moyenneUtilisateur": 5
                },
                {
                    "userId": 8,
                    "pseudo": "christophe",
                    "noteDate": "14 juillet 2009",
                    "moyenneUtilisateur": 5
                },
                 {
                     "userId": 9,
                     "pseudo": "sunny",
                     "noteDate": "25 janvier 2008",
                     "moyenneUtilisateur": 5
                 }
            ]
        };

        var anOpen = [];
        var sImageUrl = "/release-datatables/examples/examples_support/";

        var oTable = $('#utilisateurs').dataTable({
            "bProcessing": true,
            "sAjaxSource": data, // "/release-datatables/examples/ajax/sources/objects.txt",
            "aoColumns": [
                {
                    "mDataProp": null,
                    "sClass": "control center",
                    "sDefaultContent": '<img src="' + sImageUrl + 'details_open.png' + '">'
                },
                { "mDataProp": "pseudo" },
                { "mDataProp": "noteDate" },
                { "mDataProp": "moyenneUtilisateur" }
            ]
        });
    });

    $('#example td.control').live('click', function () {
        var nTr = this.parentNode;
        var i = $.inArray(nTr, anOpen);

        if (i === -1) {
            $('img', this).attr('src', sImageUrl + "details_close.png");
            oTable.fnOpen(nTr, fnFormatDetails(oTable, nTr), 'details');
            anOpen.push(nTr);
        }
        else {
            $('img', this).attr('src', sImageUrl + "details_open.png");
            oTable.fnClose(nTr);
            anOpen.splice(i, 1);
        }
    });

    function fnFormatDetails(oTable, nTr) {
        var oData = oTable.fnGetData(nTr);
        var sOut =
          '<div class="innerDetails">' +
            '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
              '<tr><td>Rendering engine:</td><td>' + oData.engine + '</td></tr>' +
              '<tr><td>Browser:</td><td>' + oData.browser + '</td></tr>' +
              '<tr><td>Platform:</td><td>' + oData.platform + '</td></tr>' +
              '<tr><td>Version:</td><td>' + oData.version + '</td></tr>' +
              '<tr><td>Grade:</td><td>' + oData.grade + '</td></tr>' +
            '</table>' +
          '</div>';
        return sOut;
    }
</script>